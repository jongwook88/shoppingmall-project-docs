[TOC]

---

![1562932814391](assets/1562932814391.png)

# ëª©ì°¨

![1562918368199](assets/1562918368199.png)

# 1. íšŒì›ê°€ì…

![1562660477778](assets/1562660477778.png)

> í•„ìš” API
>
> íšŒì›ê°€ì… ìš”ì²­ : `/api/user/join`
>
> ![1562932836383](assets/1562932836383.png)
>
> ì•„ì´ë”” ì¤‘ë³µ ì²´í¬ ìš”ì²­ : `api/user/checkId`
>
> ![1562932847185](assets/1562932847185.png)

<br>

## ğŸˆController Test

### 1) íšŒì›ê°€ì… ìš”ì²­ TDD

**UserControllerTest.java**

```java
@Test
public void testJoinUser() throws Exception {

    UserVo userVo = new UserVo();
    userVo.setId("testId");
    userVo.setName("testUser");
    userVo.setPassword("1234");
    userVo.setPasswordQuestion("ê°€ì¥ ì•„ë¼ëŠ” ë³´ë¬¼ì€?");
    userVo.setPasswordAnswer("ìˆ˜ì²©");
    userVo.setPhoneNumber("010-9274-3036");
    userVo.setEmail("leeap1004@gmail.com");

    ResultActions resultActions = 
        mockMvc
        .perform(post("/user/join")
                 .contentType(MediaType.APPLICATION_JSON).content(new Gson().toJson(userVo)));

    resultActions 
        .andExpect(status().isOk()).andDo(print())
        .andExpect(jsonPath("$.result", is("success") ))
        .andExpect(jsonPath("$.result", is("success") ))
        .andExpect(jsonPath("$.data.name", is(userVo.getName())))
        .andExpect(jsonPath("$.data.phoneNumber", is(userVo.getPhoneNumber())));
}
```

**UserController.java**

```java
@Controller
@RequestMapping("/user")
public class UserController {

	@RequestMapping(value="/join", method=RequestMethod.POST) 
	public JSONResult joinUser(@RequestBody UserVo userVo) {
		return JSONResult.success(userVo);
	}
}
 
```

### 2) ì•„ì´ë”” ì¤‘ë³µì²´í¬

**UserControllerTest.java**

```java
@Test
public void testCheckId() throws Exception {

    String id = "userId";

    ResultActions resultActions = 
        mockMvc
        .perform(get("/api/user/checkId?id={id}", id)
                 .contentType(MediaType.APPLICATION_JSON));

    resultActions 
        .andExpect(status().isOk()).andDo(print())
        .andExpect(jsonPath("$.result", is("success") ))
        .andExpect(jsonPath("$.data", is(false))); 
    //  false : íšŒì›ê°€ì… ê°€ëŠ¥, true : ì¤‘ë³µ ì•„ì´ë”” ì¡´ì¬
}
```

**UserController.java**

```java
@RequestMapping(value="/checkId", method=RequestMethod.GET) 
public JSONResult checkId(@RequestParam(value="id") String id) {
    Boolean exist = false;
    return JSONResult.success(exist);
} 
```



## ğŸˆ UserService ì¶”ê°€

**UserController.java**

```java
@RestController("userAPIController")
@RequestMapping("/api/user")
public class UserController {

    @Autowired
    private UserService userService;

    @RequestMapping(value="/join", method=RequestMethod.POST) 
    public JSONResult joinUser(@RequestBody UserVo userVo) {
        UserVo vo = userService.joinUser(userVo);
        return JSONResult.success(vo);
    }

    @RequestMapping(value="/checkId", method=RequestMethod.GET) 
    public JSONResult checkId(@RequestParam(value="id") String id) {
        Boolean exist = false;
        return JSONResult.success(exist);
    } 

}
```

**UserService.java**

```java
@Service
public class UserService {
	public UserVo joinUser(UserVo userVo) {
		return userVo;
	}
	
	public Boolean checkId( String id) {
		Boolean exist = false;
		return exist;
	} 
}
```



## ğŸˆ UserDao ì¶”ê°€

**UserController.java**

```java
@RestController("userAPIController")
@RequestMapping("/api/user")
public class UserController {
	
	@Autowired
	private UserService userService;

	@RequestMapping(value="/join", method=RequestMethod.POST) 
	public JSONResult joinUser(@RequestBody UserVo userVo) {
		UserVo vo = userService.joinUser(userVo);
		return JSONResult.success(vo);
	}

	@RequestMapping(value="/checkId", method=RequestMethod.GET) 
	public JSONResult checkId(@RequestParam(value="id") String id) {
		Boolean exist = userService.checkId(id);
		return JSONResult.success(exist);
	} 
}
```

**UserService.java**

```java
@Service
public class UserService {
	@Autowired
	private UserDao userDao;
	
	public UserVo joinUser(UserVo userVo) {
		System.out.println("ë“¤ì–´ê°€ê¸°ì „ !!!!");
		UserVo vo = userDao.insert(userVo);
		System.out.println("ë“¤ì–´ê°”ë‹¤ì˜´!@!@!@!!!!");
		return vo;
	}
	
	public Boolean checkId( String id) {
		Boolean exist = userDao.getId(id);
		return exist;
	} 
}
```

**UserDao.java**

```java
@Repository
public class UserDao {
    @Autowired 
    private SqlSession sqlSession;

    public UserVo insert(UserVo vo) {
        return vo;
    }

    public Boolean getId(String id) {
        return false;
    }
}
```



### + íšŒì›ê°€ì… ìœ íš¨ì„±(ì •ê·œì‹) ê²€ì‚¬ ì¶”ê°€

**UserController.java**

```java
@RequestMapping(value="/join", method=RequestMethod.POST) 
public ResponseEntity<JSONResult> joinUser(@RequestBody @Valid UserVo userVo,
                                           BindingResult result) {

    if(result.hasErrors()) {
        List<ObjectError> allErrors = result.getAllErrors();
        for(ObjectError error : allErrors) {
            return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(JSONResult.fail(error.getDefaultMessage()));
        }
    }

    // ìœ íš¨ì„±ê²€ì‚¬
    if(!Pattern.matches(UserVo.CHECK_ID_VALID, userVo.getId())) {
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(JSONResult.fail("ì˜ëª»ëœ ì•„ì´ë”” í˜•ì‹ì…ë‹ˆë‹¤."));
    }else if(!Pattern.matches(UserVo.CHECK_PASSWORD_VALID, userVo.getPassword())) {
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(JSONResult.fail("ì˜ëª»ëœ ë¹„ë°€ë²ˆí˜¸ í˜•ì‹ì…ë‹ˆë‹¤."));
    }else if(!Pattern.matches(UserVo.CHECK_PHONE_VALID, userVo.getPhoneNumber())) {
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(JSONResult.fail("ì˜ëª»ëœ ì „í™”ë²ˆí˜¸ í˜•ì‹ì…ë‹ˆë‹¤."));
    }else if(!Pattern.matches(UserVo.CHECK_NAME_VALID, userVo.getName())){
        return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(JSONResult.fail("ì˜ëª»ëœ ì´ë¦„ í˜•ì‹ì…ë‹ˆë‹¤."));
    }

    UserVo vo = userService.joinUser(userVo);
    return ResponseEntity.status(HttpStatus.OK).body(JSONResult.success(vo));
}
```

**UserVo.java**

```java
public class UserVo {

    // ì˜ë¬¸ì‹œì‘ íŠ¹ìˆ˜ë¬¸ì ë¶ˆê°€ëŠ¥('-'ê°€ëŠ¥), 5~12ì 
    public static final String CHECK_ID_VALID = "^[a-zA-Z]{1}[a-zA-Z0-9_]{4,11}$";

    // ì •ê·œì‹ (ì˜ë¬¸(ëŒ€ì†Œë¬¸ì êµ¬ë¶„), ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì ì¡°í•©, 9~12ìë¦¬)
    public static final String CHECK_PASSWORD_VALID = "^(?=.*\\d)(?=.*[~`!@#$%\\^&*()-])(?=.*[a-z])(?=.*[A-Z]).{9,12}$";

    // ì „í™”ë²ˆí˜¸ ì •ê·œì‹
    public static final String CHECK_PHONE_VALID = "^01(?:0|1|[6-9])-(?:\\d{3}|\\d{4})-\\d{4}$"; 

    // ì˜ë¬¸ í˜¹ì€ í•œê¸€ ì´ë¦„(ë‘˜ ë‹¤ ì‚¬ìš© ë¶ˆê°€)
    public static final String CHECK_NAME_VALID = "^[ê°€-í£]{2,4}|^[a-zA-Z]*$";

    private Long no;

    @NotEmpty(message="ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    private String id;

    @NotEmpty(message="ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”")
    @Length(min = 2, max = 8, message="ì´ë¦„ í˜•ì‹ì´ ì˜ëª»ë˜ì—ˆìŠµë‹ˆë‹¤.")
    private String name;

    @NotEmpty(message="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
    private String password;

    private String passwordQuestion;

    @Length(min = 2, message="ë‹µë³€ì€ 2ê¸€ì ì´ìƒì„ ì…ë ¥í•´ì£¼ì„¸ìš”.")
    private String passwordAnswer;

    @NotEmpty(message="ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
    private String phoneNumber;

    @Email(message="ì´ë©”ì¼ í˜•ì‹ì´ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.")
    @NotEmpty(message="ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”")
    private String email;
    private String birthDate;

    private String point;
    private String endDate;

    public UserVo() {
        super();
    }

    public UserVo(String id, String name, String password, String passwordQuestion, 
                  String passwordAnswer, String phoneNumber, String email) {
        this.id = id;
        this.name = name;
        this.password = password;
        this.passwordQuestion = passwordQuestion;
        this.passwordAnswer = passwordAnswer;
        this.phoneNumber = phoneNumber;
        this.email = email;
    }
    ...
}

```



# 2. ë¡œê·¸ì¸

![1562659826464](assets/login.png)

> í•„ìš” API
>
> ë¡œê·¸ì¸ ìš”ì²­ : `api/user/login`
>
> ![1562932867728](assets/1562932867728.png)
>
> ì•„ì´ë”” ì°¾ê¸° ìš”ì²­ : `/api/user/findId`
>
> ![1562932879195](assets/1562932879195.png)



## ğŸˆController Test

### 1) ë¡œê·¸ì¸ ìš”ì²­ TDD

**UserControllerTest.java**

```java
@Test
public void testlogin() throws Exception {

    String id = "userId";
    String password = "userPW";

    ResultActions resultActions = 
        mockMvc
        .perform(get("/api/user/login?id={id}&password={password}", id, password)
                 .contentType(MediaType.APPLICATION_JSON));

    resultActions 
        .andExpect(status().isOk()).andDo(print())
        .andExpect(jsonPath("$.result", is("success") ))
        .andExpect(jsonPath("$.data", is(false))); 
    //  false : ë¡œê·¸ì¸ ì‹¤íŒ¨, true : ë¡œê·¸ì¸ ê°€ëŠ¥
}
```

**UserController.java**

```java
@RequestMapping(value="/login", method=RequestMethod.GET) 
public JSONResult login(@RequestParam(value="id") String id, @RequestParam(value="password") String password) {
    Boolean exist = userService.getUser(id, password);
    return JSONResult.success(exist);
} 
```

**UserService.java**

```java
public Boolean getUser(String id, String password) {
    Boolean exist = userDao.get(id, password);
    return exist;
}
```

**UserDao.java**

```java
public Boolean get(String id, String password) {
    return false;
}
```

> ì´í›„ëŠ” Controller ì½”ë“œë§Œ ì²¨ë¶€í•¨



### 2) ì•„ì´ë”” ì°¾ê¸° ìš”ì²­ TDD

> emailì„ íšŒì›tableì—ì„œ ì°¾ì•„, ìˆìœ¼ë©´ í•´ë‹¹ ë©”ì¼ë¡œ IDì „ì†¡ or ì¸ì¦ë²ˆí˜¸ ì „ì†¡

**UserController.java**

```java
@RequestMapping(value="/findId", method=RequestMethod.GET) 
public JSONResult findId(@RequestParam(value = "email") String email) {
    String userId = userService.getUser(email);
    return JSONResult.success(userId);
} 
```

**UserControllerTest.java**

```java
@Test
public void findId() throws Exception {

    String email = "leeap1004@gmail.com";

    ResultActions resultActions = 
        mockMvc
        .perform(get("/api/user/findId?email={email}", email)
                 .contentType(MediaType.APPLICATION_JSON));

    resultActions 
        .andExpect(status().isOk()).andDo(print())
        .andExpect(jsonPath("$.result", is("success") ))
        .andExpect(jsonPath("$.data", is(email))); 
}
```



### 3) ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ìš”ì²­

> emailì„ íšŒì›tableì—ì„œ ì°¾ì•„, ìˆìœ¼ë©´ í•´ë‹¹ ë©”ì¼ë¡œ ì„ì˜ ë³€ê²½ PWì „ì†¡ or ì¸ì¦ë²ˆí˜¸ ì „ì†¡ ì¸ì¦



# 3. ìƒí’ˆ ëª©ë¡

![1562659826464](assets/1562659826464.png)

> í•„ìš” API
>
> ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°(ë©”ì¸) : `api/main`
>
> ![1562932896158](assets/1562932896158.png)
>
> ê²€ìƒ‰  & í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ìƒí’ˆ ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°:`/api/product/{categoryNo}`
>
> ![1562932914344](assets/1562932914344.png)

## ğŸˆ Controller Test

### 1) ìƒí’ˆë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° TDD

**ProductController.java**

```java
@RestController("productAPIController")
@RequestMapping("/api/product")
public class ProductController {

	@Autowired
	private ProductService productService;

	@RequestMapping(value = "/{categoryNo}", method = RequestMethod.GET)
	public JSONResult getProductList(@PathVariable(value = "categoryNo") Long categoryNo,
			@RequestParam(value="keyword", required = false, defaultValue = "") String keyword) {
		
		// í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ list return
		List<ProductVo> list = productService.getProductList(categoryNo, keyword);
		return JSONResult.success(list);
	}
}
```

**ProductControllerTest.java**

```java
@Test
public void testGetProductList() throws Exception {
    int categoryNo = 1;
    ResultActions resultActions = 
        mockMvc
        .perform(get("/api/product/{categoryNo}", categoryNo)
                 .param("keyword","ìƒì˜")		
                 .contentType(MediaType.APPLICATION_JSON)); 

    resultActions 
        .andExpect(status().isOk()).andDo(print());

}
```





# 4. ìƒí’ˆ ìƒì„¸

> TODO : ìƒí’ˆ ìƒì„¸ì— ë°”ë¡œ ì£¼ë¬¸ ë„£ê¸°!!!!!!!

![1562659902012](assets/1562659902012.png)

> ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆ ì¶”ê°€ : `/api/cart/add/{userId}/{optionNo}`
>
> > ê²°ê³¼ return : true or false
>
> ![1562932169506](assets/1562932169506.png)
>
> ë¹„íšŒì›ì˜ ê²½ìš° session id=userId

## ğŸˆ Controller Test

**CartController.java**

```java
@RequestMapping(value = "/{userId}/{optionNo}", method = RequestMethod.POST)
public JSONResult addCart(@PathVariable(value="userId") String userId,
                          @PathVariable(value="optionNo") Long optionNo) {
    // í•´ë‹¹ íšŒì›(userId)ì˜ ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆ(optionNo)ì¶”ê°€
    boolean result = CartService.addCart(userId, optionNo);
    return JSONResult.success(result);
}
```

**CartControllerTest.java**

```java
@Test
public void testAddCart() throws Exception {
    String userId = "leeap1004";
    Long optionNo = 1L;
    ResultActions resultActions = 
        mockMvc
        .perform(post("/api/cart/{userId}/{optionNo}", userId, optionNo)
                 .contentType(MediaType.APPLICATION_JSON)); 

    resultActions 
        .andExpect(status().isOk()).andDo(print());

}
```

<br>

# 5. ì¥ë°”êµ¬ë‹ˆ

![1562655774676](assets/productdetail.png)

> í•„ìš” api
>
> ì¥ë°”êµ¬ë‹ˆ ì¡°íšŒ:`/api/cart/{userId}`
>
> ![1562932027036](assets/1562932027036.png)
>
> ì¥ë°”êµ¬ë‹ˆ ìˆ˜ì • - ì˜µì…˜ ìˆ˜ì • : `/modify/{userId}/{cartNo}`
>
> ì¥ë°”êµ¬ë‹ˆ ìˆ˜ì • - ìˆ˜ëŸ‰ ìˆ˜ì • : `/modify/{userId}/{cartNo}`
>
> ![1562917273732](assets/modifycart.png)
>
> ì¥ë°”êµ¬ë‹ˆ ì‚­ì œ`/cart/delete/{userId}/{cartNo}`
>
> ![1562932212797](assets/1562932212797.png)

## ğŸˆ Controller Test

**CartController.java**

```java
@RestController("cartAPIController")
@RequestMapping("/api/cart")
public class CartController {

    @Autowired
    private ProductService productService;

    @Autowired
    private CartService CartService;

    @RequestMapping(value = "/{userId}", method = RequestMethod.GET)
    public JSONResult getCartList(@PathVariable(value="userId") String userId) {

        // ìƒí’ˆ list return
        List<ProductVo> list = productService.getProductList(userId);
        return JSONResult.success(list);
    }

    @RequestMapping(value = "/{userId}/{optionNo}", method = RequestMethod.POST)
    public JSONResult addCart(@PathVariable(value="userId") String userId,
                              @PathVariable(value="optionNo") Long optionNo) {
        // í•´ë‹¹ íšŒì›(userId)ì˜ ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆ(optionNo)ì¶”ê°€
        boolean result = CartService.addCart(userId, optionNo);
        return JSONResult.success(result);
    }

    @RequestMapping(value = "/modify/{userId}/{cartNo}", method = RequestMethod.POST)
    public JSONResult modifyCart(
        @PathVariable(value="userId") String userId,
        @PathVariable(value="cartNo") Long cartNo,
        @RequestParam(value="optionNo", required = false, defaultValue = "0") Long optionNo,
        @RequestParam(value="quantity", required = false, defaultValue = "0") Long quantity) {
        boolean result = false;

        if(optionNo!=0) {
            // í•´ë‹¹ íšŒì›(userId)ì˜ ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆ(optionNo)ì¶”ê°€
            result = CartService.modifyCartOption(userId, cartNo, optionNo);			
        }else if(quantity!=0) {
            // í•´ë‹¹ íšŒì›(userId)ì˜ ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆ(optionNo)ì¶”ê°€
            result = CartService.modifyCartQuantity(userId, cartNo, quantity);
        }
        return JSONResult.success(result);
    }

    @RequestMapping(value = "/delete/{userId}/{cartNo}", method = RequestMethod.DELETE)
    public JSONResult deleteCart(
        @PathVariable(value="userId") String userId,
        @PathVariable(value="cartNo") Long cartNo) {

        boolean result = CartService.deleteCart(userId, cartNo);

        return JSONResult.success(result);
    }
}
```

**CartControllerTest.java**

```java
@Test
public void testGetCart() throws Exception {
    String userId = "leeap1004";
    ResultActions resultActions = 
        mockMvc
        .perform(get("/api/cart/{userId}", userId)
                 .contentType(MediaType.APPLICATION_JSON)); 

    resultActions 
        .andExpect(status().isOk()).andDo(print());

}

@Test
public void testAddCart() throws Exception {
    String userId = "leeap1004";
    Long optionNo = 1L;
    ResultActions resultActions = 
        mockMvc
        .perform(post("/api/cart/{userId}/{optionNo}", userId, optionNo)
                 .contentType(MediaType.APPLICATION_JSON)); 

    resultActions 
        .andExpect(status().isOk()).andDo(print());

}

@Test
public void testModifyCartOption() throws Exception {
    // leeap1004íšŒì›ì˜ ì¥ë°”êµ¬ë‹ˆ 2ë²ˆì˜ ì˜µì…˜ì„ 1ë¡œ ë³€ê²½
    String userId = "leeap1004";
    String cartNo = "2";
    String optionNo = "1";
    ResultActions resultActions = 
        mockMvc
        .perform(post("/api/cart/modify/{userId}/{cartNo}", userId, cartNo)
                 .param("optionNo", optionNo)
                 .contentType(MediaType.APPLICATION_JSON)); 

    resultActions 
        .andExpect(status().isOk()).andDo(print());

}

@Test
public void testModifyCartQuantity() throws Exception {
    // leeap1004íšŒì›ì˜ ì¥ë°”êµ¬ë‹ˆ 2ë²ˆì˜ ì˜µì…˜ì˜ ìˆ˜ëŸ‰ì„ 3ìœ¼ë¡œ ë³€ê²½
    String userId = "leeap1004";
    String cartNo = "2";
    String quantity = "3";
    ResultActions resultActions = 
        mockMvc
        .perform(post("/api/cart/modify/{userId}/{cartNo}", userId, cartNo)
                 .param("quantity", quantity)
                 .contentType(MediaType.APPLICATION_JSON)); 

    resultActions 
        .andExpect(status().isOk()).andDo(print());

}

@Test
public void testDeleteCart() throws Exception {
    // leeap1004íšŒì›ì˜ ì¥ë°”êµ¬ë‹ˆ 2Lë²ˆì˜ ì˜µì…˜ì„ ì‚­ì œ
    String userId = "leeap1004";
    String cartNo = "2";
    ResultActions resultActions = 
        mockMvc
        .perform(delete("/api/cart/delete/{userId}/{cartNo}", userId, cartNo)
                 .contentType(MediaType.APPLICATION_JSON)); 

    resultActions 
        .andExpect(status().isOk()).andDo(print());

}
```



# 6. ì£¼ë¬¸ë‚´ì—­ í™•ì¸

![checkorder](assets/checkorder.png)

> ìƒˆ í˜ì´ì§€ ë¡œë“œ









